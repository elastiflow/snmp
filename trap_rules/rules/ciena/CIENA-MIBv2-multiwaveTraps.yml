- mapping: |-
    #!blobl
    root = this
    root.out.origin.agent.name = "CIENA-MIBv2"
- switch:
    - check: this.trap.SpecificTrap == 1
      processors:
        - label: mw_attribute_change
          mapping: |-
            #!blobl
            root = this

            root.out.event.category.name = lookup(this.trap.VarBinds.index(4).Value.enum_enrich(".1.3.6.1.4.1.1271.1.3.1.1.7").string(), cienaMwModuleType)
            root.out.object.name = "Shelf " + this.trap.VarBinds.index(2).Value.string() + ", Slot " + this.trap.VarBinds.index(3).Value.string()
            root.out.event.message = lookup(this.trap.VarBinds.index(4).Value.enum_enrich(".1.3.6.1.4.1.1271.1.3.1.1.7").string(), cienaMwModuleType) + " ( " + "Shelf " + this.trap.VarBinds.index(2).Value.string() + ", Slot " + this.trap.VarBinds.index(3).Value.string() + " ): " + this.trap.VarBinds.index(8).Value.snmp_v2_tc_display_string().string().replace_all("\\s+$", "")

            root.out.ciena.nodeName = this.trap.VarBinds.index(0).Value.snmp_v2_tc_display_string()
            root.out.ciena.etNodeStatus = this.trap.VarBinds.index(1).Value
            root.out.ciena.shelfId = this.trap.VarBinds.index(2).Value
            root.out.ciena.slotId = this.trap.VarBinds.index(3).Value
            root.out.ciena.moduleType = this.trap.VarBinds.index(4).Value.enum_enrich(".1.3.6.1.4.1.1271.1.3.1.1.7")
            root.out.ciena.moduleStatus = this.trap.VarBinds.index(5).Value
            root.out.ciena.alarmAttrId = this.trap.VarBinds.index(6).Value
            root.out.ciena.alarmSeverity = this.trap.VarBinds.index(7).Value.enum_enrich(".1.3.6.1.4.1.1271.1.3.9.1.3")
            root.out.ciena.etAttrMessage = this.trap.VarBinds.index(8).Value.snmp_v2_tc_display_string()
        - label: mw_attribute_change_nested_switch
          switch:
            - check: this.trap.VarBinds.index(7).Value == 2048
              processors:
                - label: mw_attribute_change_nested_switch_2048
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(7).Value == 2050
              processors:
                - label: mw_attribute_change_nested_switch_2050
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(7).Value == 2052
              processors:
                - label: mw_attribute_change_nested_switch_2052
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(7).Value == 2053
              processors:
                - label: mw_attribute_change_nested_switch_2053
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(7).Value == 2054
              processors:
                - label: mw_attribute_change_nested_switch_2054
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(7).Value == 2055
              processors:
                - label: mw_attribute_change_nested_switch_2055
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(7).Value == 2056
              processors:
                - label: mw_attribute_change_nested_switch_2056
                  mapping: |+
                    #!blobl
                    root = this

            - processors:
                - label: mw_attribute_change_nested_switch_default
                  mapping: |+
                    #!blobl
                    root = this

        - label: mw_attribute_change_after_switch
          mapping: |+
            #!blobl
            root = this

    - check: this.trap.SpecificTrap == 2
      processors:
        - label: mw_alarm_asserted
          mapping: |-
            #!blobl
            root = this

            root.out.event.category.name = lookup(this.trap.VarBinds.index(3).Value.enum_enrich(".1.3.6.1.4.1.1271.1.3.1.1.7").string(), cienaMwModuleType)
            root.out.object.name = "Shelf " + this.trap.VarBinds.index(1).Value.string() + ", Slot " + this.trap.VarBinds.index(2).Value.string()
            root.out.event.message = lookup(this.trap.VarBinds.index(3).Value.enum_enrich(".1.3.6.1.4.1.1271.1.3.1.1.7").string(), cienaMwModuleType) + " ( " + "Shelf " + this.trap.VarBinds.index(1).Value.string() + ", Slot " + this.trap.VarBinds.index(2).Value.string() + " ): " + this.trap.VarBinds.index(7).Value.snmp_v2_tc_display_string().string().replace_all("\\s+$", "")

            root.out.ciena.etNodeStatus = this.trap.VarBinds.index(0).Value
            root.out.ciena.shelfId = this.trap.VarBinds.index(1).Value
            root.out.ciena.slotId = this.trap.VarBinds.index(2).Value
            root.out.ciena.moduleType = this.trap.VarBinds.index(3).Value.enum_enrich(".1.3.6.1.4.1.1271.1.3.1.1.7")
            root.out.ciena.moduleStatus = this.trap.VarBinds.index(4).Value
            root.out.ciena.alarmCriticality = this.trap.VarBinds.index(5).Value
            root.out.ciena.alarmSequence = this.trap.VarBinds.index(6).Value
            root.out.ciena.alarmCondition = this.trap.VarBinds.index(7).Value.snmp_v2_tc_display_string()
        - label: mw_alarm_asserted_nested_switch
          switch:
            - check: this.trap.VarBinds.index(5).Value.string() == 2048
              processors:
                - label: mw_alarm_asserted_nested_switch_2048
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(5).Value.string() == 2050
              processors:
                - label: mw_alarm_asserted_nested_switch_2050
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(5).Value.string() == 2052
              processors:
                - label: mw_alarm_asserted_nested_switch_2052
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(5).Value.string() == 2053
              processors:
                - label: mw_alarm_asserted_nested_switch_2053
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(5).Value.string() == 2054
              processors:
                - label: mw_alarm_asserted_nested_switch_2054
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(5).Value.string() == 2055
              processors:
                - label: mw_alarm_asserted_nested_switch_2055
                  mapping: |+
                    #!blobl
                    root = this

            - check: this.trap.VarBinds.index(5).Value.string() == 2056
              processors:
                - label: mw_alarm_asserted_nested_switch_2056
                  mapping: |+
                    #!blobl
                    root = this

            - processors:
                - label: mw_alarm_asserted_nested_switch_default
                  mapping: |+
                    #!blobl
                    root = this

        - label: mw_alarm_asserted_after_switch
          mapping: |+
            #!blobl
            root = this

    - check: this.trap.SpecificTrap == 3
      processors:
        - label: mw_alarm_cleared
          mapping: |-
            #!blobl
            root = this

            root.out.event.category.name = lookup(this.trap.VarBinds.index(3).Value.enum_enrich(".1.3.6.1.4.1.1271.1.3.1.1.7").string(), cienaMwModuleType)
            root.out.object.name = "Shelf " + this.trap.VarBinds.index(1).Value.string() + ", Slot " + this.trap.VarBinds.index(2).Value.string()
            root.out.event.message = "Alarm Cleared for " + lookup(this.trap.VarBinds.index(3).Value.enum_enrich(".1.3.6.1.4.1.1271.1.3.1.1.7").string(), cienaMwModuleType) + "  ( " + "Shelf " + this.trap.VarBinds.index(1).Value.string() + ", Slot " + this.trap.VarBinds.index(2).Value.string() + " )"

            root.out.ciena.etNodeStatus = this.trap.VarBinds.index(0).Value
            root.out.ciena.shelfId = this.trap.VarBinds.index(1).Value
            root.out.ciena.slotId = this.trap.VarBinds.index(2).Value
            root.out.ciena.moduleType = this.trap.VarBinds.index(3).Value.enum_enrich(".1.3.6.1.4.1.1271.1.3.1.1.7")
            root.out.ciena.moduleStatus = this.trap.VarBinds.index(4).Value
            root.out.ciena.alarmCriticality = this.trap.VarBinds.index(5).Value
            root.out.ciena.alarmSequence = this.trap.VarBinds.index(6).Value
    - check: this.trap.SpecificTrap == 4
      processors:
        - label: mw_dump_present
          mapping: |
            #!blobl
            root = this

            root.out.event.category.name = lookup($4, cienaMwModuleType)
            root.out.object.name = "Shelf $2, Slot $3
            root.out.event.message = "NCP Crashed and Restarted  (see Dump Records for details)"
        - label: mw_dump_present_nested_switch
          switch:
            - check: ' == 2048'
              processors:
                - label: mw_dump_present_nested_switch_2048
                  mapping: |+
                    #!blobl
                    root = this

            - check: ' == 2050'
              processors:
                - label: mw_dump_present_nested_switch_2050
                  mapping: |+
                    #!blobl
                    root = this

            - check: ' == 2052'
              processors:
                - label: mw_dump_present_nested_switch_2052
                  mapping: |+
                    #!blobl
                    root = this

            - check: ' == 2053'
              processors:
                - label: mw_dump_present_nested_switch_2053
                  mapping: |+
                    #!blobl
                    root = this

            - check: ' == 2054'
              processors:
                - label: mw_dump_present_nested_switch_2054
                  mapping: |+
                    #!blobl
                    root = this

            - check: ' == 2055'
              processors:
                - label: mw_dump_present_nested_switch_2055
                  mapping: |+
                    #!blobl
                    root = this

            - check: ' == 2056'
              processors:
                - label: mw_dump_present_nested_switch_2056
                  mapping: |+
                    #!blobl
                    root = this

            - processors:
                - label: mw_dump_present_nested_switch_default
                  mapping: |+
                    #!blobl
                    root = this

        - label: mw_dump_present_after_switch
          mapping: |+
            #!blobl
            root = this

    - processors:
        - label: default
          mapping: |
            #!blobl,
            root = this
            root.out.event.category.name = "Unknown Trap"
