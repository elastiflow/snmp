- mapping: |-
    #!blobl
    root = this
    root.out.origin.agent.name = "Fortinet FORTINET-FORTIGATE-MIB"
- switch:
  - check: this.trap.SpecificTrap == 301
    # fgTrapVpnTunUp
    #
    # Indicates that the specified VPN tunnel has been brought up.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgVpnTrapLocalGateway (IpAddress) - Local gateway IP address.
    # fgVpnTrapRemoteGateway (IpAddress) - Remote gateway IP address.
    # fgVpnTrapPhase1Name (DisplayString) - Name of the phase 1.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 4 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.12.3.2") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.12.3.3") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.12.3.4") {
              meta varbinds_ok = true
          }}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgVpnTrapLocalGateway = this.trap.VarBinds.index(2).Value
                root.out.fortinet.fgVpnTrapRemoteGateway = this.trap.VarBinds.index(3).Value
                root.out.fortinet.fgVpnTrapPhase1Name = this.trap.VarBinds.index(4).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgVpn"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "local gateway: " + root.out.fortinet.fgVpnTrapLocalGateway + ", remote gateway: " + root.out.fortinet.fgVpnTrapRemoteGateway + ", phase-1: " + root.out.fortinet.fgVpnTrapPhase1Name

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapVpnTunUp"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapVpnTunUp"
                root.out.event.category.name = "VPN tunnel state"
                root.out.event.message = "VPN tunnel up"
                root.out.event.severity.code = 6
                root.out.event.severity.level = "Informational"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapVpnTunUp"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapVpnTunUp-unknown"
              root.out.event.category.name = "VPN tunnel state"
              root.out.event.message = "VPN tunnel up - UNEXPECTED VARBINDS for fgTrapVpnTunUp trap!"
              root.out.event.severity.code = 5
              root.out.event.severity.level = "Notice"

  - check: this.trap.SpecificTrap == 302
    # fgTrapVpnTunDown
    #
    # The specified VPN tunnel has been brought down.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgVpnTrapLocalGateway (IpAddress) - Local gateway IP address.
    # fgVpnTrapRemoteGateway (IpAddress) - Remote gateway IP address.
    # fgVpnTrapPhase1Name (DisplayString) - Name of the phase 1.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 4 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.12.3.2") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.12.3.3") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.12.3.4") {
              meta varbinds_ok = true
          }}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgVpnTrapLocalGateway = this.trap.VarBinds.index(2).Value
                root.out.fortinet.fgVpnTrapRemoteGateway = this.trap.VarBinds.index(3).Value
                root.out.fortinet.fgVpnTrapPhase1Name = this.trap.VarBinds.index(4).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgVpn"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "local gateway: " + root.out.fortinet.fgVpnTrapLocalGateway + ", remote gateway: " + root.out.fortinet.fgVpnTrapRemoteGateway + ", phase-1: " + root.out.fortinet.fgVpnTrapPhase1Name

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapVpnTunDown"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapVpnTunDown"
                root.out.event.category.name = "VPN tunnel state"
                root.out.event.message = "VPN tunnel down"
                root.out.event.severity.code = 3
                root.out.event.severity.level = "Error"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapVpnTunDown"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapVpnTunDown-unknown"
              root.out.event.category.name = "VPN tunnel state"
              root.out.event.message = "VPN tunnel down - UNEXPECTED VARBINDS for fgTrapVpnTunDown trap!"
              root.out.event.severity.code = 3
              root.out.event.severity.level = "Error"

  - check: this.trap.SpecificTrap == 401
    # fgTrapHaSwitch
    #
    # The specified cluster member has transitioned from a secondary role to a primary role.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 1 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
              meta varbinds_ok = true
          }}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgHighAvailability"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaSwitch"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaSwitch"
                root.out.event.category.name = "HA cluster member role state"
                root.out.event.message = "HA cluster member transitioned from secondary to primary"
                root.out.event.severity.code = 5
                root.out.event.severity.level = "Notice"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaSwitch"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaSwitch-unknown"
              root.out.event.category.name = "HA cluster member role state"
              root.out.event.message = "HA cluster member role state unknown - UNEXPECTED VARBINDS for fgTrapHaSwitch trap!"
              root.out.event.severity.code = 4
              root.out.event.severity.level = "Warning"

  - check: this.trap.SpecificTrap == 402
    # fgTrapHaStateChange
    #
    # Trap being sent when the HA cluster member changes its state
    #
    # fnSysSerial (DisplayString) - device serial number.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 0 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
              meta varbinds_ok = true
          }}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgHighAvailability"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaStateChange"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaStateChange"
                root.out.event.category.name = "HA cluster member state"
                root.out.event.message = "HA cluster member state changed"
                root.out.event.severity.code = 4
                root.out.event.severity.level = "Warning"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaStateChange"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaStateChange-unknown"
              root.out.event.category.name = "HA cluster member state"
              root.out.event.message = "HA cluster member state changed - UNEXPECTED VARBINDS for fgTrapHaStateChange trap!"
              root.out.event.severity.code = 4
              root.out.event.severity.level = "Warning"

  - check: this.trap.SpecificTrap == 403
    # fgTrapHaHBFail
    #
    # The heartbeat device failure count has exceeded the configured threshold.
    #
    # fnSysSerial (DisplayString) - device serial number.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 0 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
              meta varbinds_ok = true
          }}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgHighAvailability"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaHBFail"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaHBFail"
                root.out.event.category.name = "HA heartbeat threshold"
                root.out.event.message = "HA heartbeat failure count exceeds threshold"
                root.out.event.severity.code = 3
                root.out.event.severity.level = "Error"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaHBFail"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaHBFail-unknown"
              root.out.event.category.name = "HA heartbeat threshold"
              root.out.event.message = "HA heartbeat failure count exceeds threshold - UNEXPECTED VARBINDS for fgTrapHaHBFail trap!"
              root.out.event.severity.code = 3
              root.out.event.severity.level = "Error"

  - check: this.trap.SpecificTrap == 404
    # fgTrapHaMemberDown
    #
    # The specified device (by serial number) is moving to a down state.
    #
    # fnSysSerial (DisplayString) - device serial number.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 0 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
              meta varbinds_ok = true
          }}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgHighAvailability"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaMemberDown"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaMemberDown"
                root.out.event.category.name = "HA member state"
                root.out.event.message = "HA member down"
                root.out.event.severity.code = 3
                root.out.event.severity.level = "Error"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaMemberDown"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaMemberDown-unknown"
              root.out.event.category.name = "HA member state"
              root.out.event.message = "HA member down - UNEXPECTED VARBINDS for fgTrapHaMemberDown trap!"
              root.out.event.severity.code = 3
              root.out.event.severity.level = "Error"

  - check: this.trap.SpecificTrap == 405
    # fgTrapHaMemberUp
    #
    # A new cluster member has joined the cluster.
    #
    # fnSysSerial (DisplayString) - device serial number.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 0 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
              meta varbinds_ok = true
          }}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgHighAvailability"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaMemberUp"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaMemberUp"
                root.out.event.category.name = "HA member state"
                root.out.event.message = "HA member up"
                root.out.event.severity.code = 6
                root.out.event.severity.level = "Informational"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaMemberUp"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapHaMemberUp-unknown"
              root.out.event.category.name = "HA member state"
              root.out.event.message = "HA member up - UNEXPECTED VARBINDS for fgTrapHaMemberUp trap!"
              root.out.event.severity.code = 5
              root.out.event.severity.level = "Notice"

  - check: this.trap.SpecificTrap == 503
    # fgTrapIpsSignature
    #
    # An IPS signature has been triggered
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgIpsTrapSigId (Integer32) - ID of IPS signature
    # fgIpsTrapSrcIp (IpAddress) - Source IP Address of the IPS signature trigger
    # fgIpsTrapSigMsg (DisplayString) - Message associated with IPS event
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 4 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.9.3.1") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.9.3.2") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.9.3.3") {
              meta varbinds_ok = true
          }}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgIpsTrapSigId = this.trap.VarBinds.index(2).Value.string()
                root.out.fortinet.fgIpsTrapSrcIp = this.trap.VarBinds.index(3).Value
                root.out.fortinet.fgIpsTrapSigMsg = this.trap.VarBinds.index(4).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgIps"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "signature ID: " + root.out.fortinet.fgIpsTrapSigId + ", source IP: " + root.out.fortinet.fgIpsTrapSrcIp

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsSignature"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsSignature"
                root.out.event.category.name = "IPS signature trigger state"
                root.out.event.message = "IPS signature triggered, " + root.out.fortinet.fgIpsTrapSigMsg
                root.out.event.severity.code = 2
                root.out.event.severity.level = "Critical"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsSignature"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsSignature-unknown"
              root.out.event.category.name = "IPS signature trigger state"
              root.out.event.message = "IPS signature triggered - UNEXPECTED VARBINDS for fgTrapIpsSignature trap!"
              root.out.event.severity.code = 2
              root.out.event.severity.level = "Critical"

  - check: this.trap.SpecificTrap == 504
    # fgTrapIpsAnomaly
    #
    # An IPS anomaly has been detected
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgIpsTrapSigId (Integer32) - ID of IPS signature
    # fgIpsTrapSrcIp (IpAddress) - Source IP Address of the IPS signature trigger
    # fgIpsTrapSigMsg (DisplayString) - Message associated with IPS event
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 4 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.9.3.1") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.9.3.2") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.9.3.3") {
              meta varbinds_ok = true
          }}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgIpsTrapSigId = this.trap.VarBinds.index(2).Value.string()
                root.out.fortinet.fgIpsTrapSrcIp = this.trap.VarBinds.index(3).Value
                root.out.fortinet.fgIpsTrapSigMsg = this.trap.VarBinds.index(4).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgIps"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "signature ID: " + root.out.fortinet.fgIpsTrapSigId + ", source IP: " + root.out.fortinet.fgIpsTrapSrcIp

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsAnomaly"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsAnomaly"
                root.out.event.category.name = "IPS anomaly detection state"
                root.out.event.message = "IPS anomaly detected, " + root.out.fortinet.fgIpsTrapSigMsg
                root.out.event.severity.code = 2
                root.out.event.severity.level = "Critical"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsAnomaly"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsAnomaly-unknown"
              root.out.event.category.name = "IPS anomaly detection state"
              root.out.event.message = "IPS anomaly detected - UNEXPECTED VARBINDS for fgTrapIpsAnomaly trap!"
              root.out.event.severity.code = 2
              root.out.event.severity.level = "Critical"

  - check: this.trap.SpecificTrap == 505
    # fgTrapIpsPkgUpdate
    #
    # The IPS signature database has been updated
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 1 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
              meta varbinds_ok = true
          }}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgIps"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsPkgUpdate"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsPkgUpdate"
                root.out.event.category.name = "IPS signature update state"
                root.out.event.message = "IPS signature database updated"
                root.out.event.severity.code = 6
                root.out.event.severity.level = "Informational"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsPkgUpdate"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsPkgUpdate-unknown"
              root.out.event.category.name = "IPS signature update state"
              root.out.event.message = "IPS signature database updated - UNEXPECTED VARBINDS for fgTrapIpsPkgUpdate trap!"
              root.out.event.severity.code = 5
              root.out.event.severity.level = "Notice"

  - check: this.trap.SpecificTrap == 506
    # fgTrapIpsFailOpen
    #
    # The IPS network buffer is full
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 1 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
              meta varbinds_ok = true
          }}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgIps"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsFailOpen"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsFailOpen"
                root.out.event.category.name = "IPS network buffer state"
                root.out.event.message = "IPS network buffer full"
                root.out.event.severity.code = 3
                root.out.event.severity.level = "Error"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsFailOpen"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapIpsFailOpen-unknown"
              root.out.event.category.name = "IPS network buffer state"
              root.out.event.message = "IPS network buffer full - UNEXPECTED VARBINDS for fgTrapIpsFailOpen trap!"
              root.out.event.severity.code = 3
              root.out.event.severity.level = "Error"

  - check: this.trap.SpecificTrap == 601
    # fgTrapAvVirus
    #
    # A virus has been detected by the anti-virus engine
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgAvTrapVirName (DisplayString) - Virus name that triggered event
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 2 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.8.3.1") {
              meta varbinds_ok = true
          }}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgAvTrapVirName = this.trap.VarBinds.index(2).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgAntivirus"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "virus: " + root.out.fortinet.fgAvTrapVirName

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvVirus"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvVirus"
                root.out.event.category.name = "anti-virus detection"
                root.out.event.message = "virus detected"
                root.out.event.severity.code = 2
                root.out.event.severity.level = "Critical"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvVirus"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvVirus-unknown"
              root.out.event.category.name = "anti-virus detection"
              root.out.event.message = "virus detected - UNEXPECTED VARBINDS for fgTrapAvVirus trap!"
              root.out.event.severity.code = 2
              root.out.event.severity.level = "Critical"

  - check: this.trap.SpecificTrap == 602
    # fgTrapAvOversize
    #
    # An over-sized file has been detected by the anti-virus engine
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 1 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
              meta varbinds_ok = true
          }}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgAntivirus"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversize"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversize"
                root.out.event.category.name = "anti-virus detection"
                root.out.event.message = "over-sized file detected"
                root.out.event.severity.code = 2
                root.out.event.severity.level = "Critical"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversize"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversize-unknown"
              root.out.event.category.name = "anti-virus detection"
              root.out.event.message = "over-sized file detected - UNEXPECTED VARBINDS for fgTrapAvOversize trap!"
              root.out.event.severity.code = 2
              root.out.event.severity.level = "Critical"

  - check: this.trap.SpecificTrap == 603
    # fgTrapAvPattern
    #
    # The anti-virus engine has blocked a file because it matched a configured pattern
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 1 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
              meta varbinds_ok = true
          }}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgAntivirus"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvPattern"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvPattern"
                root.out.event.category.name = "anti-virus detection"
                root.out.event.message = "file pattern matched, file blocked"
                root.out.event.severity.code = 2
                root.out.event.severity.level = "Critical"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvPattern"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvPattern-unknown"
              root.out.event.category.name = "anti-virus detection"
              root.out.event.message = "file pattern matched, file blocked - UNEXPECTED VARBINDS for fgTrapAvPattern trap!"
              root.out.event.severity.code = 2
              root.out.event.severity.level = "Critical"

  - check: this.trap.SpecificTrap == 604
    # fgTrapAvFragmented
    #
    # The anti-virus engine has detected a fragmented file
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 1 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
              meta varbinds_ok = true
          }}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgAntivirus"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvFragmented"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvFragmented"
                root.out.event.category.name = "anti-virus detection"
                root.out.event.message = "fragmented file detected"
                root.out.event.severity.code = 2
                root.out.event.severity.level = "Critical"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvFragmented"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvFragmented-unknown"
              root.out.event.category.name = "anti-virus detection"
              root.out.event.message = "fragmented file detected - UNEXPECTED VARBINDS for fgTrapAvFragmented trap!"
              root.out.event.severity.code = 2
              root.out.event.severity.level = "Critical"

  - check: this.trap.SpecificTrap == 605
    # fgTrapAvEnterConserve
    #
    # The anti-virus engine has entered conservation mode due to low memory conditions
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 1 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
              meta varbinds_ok = true
          }}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgAntivirus"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvEnterConserve"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvEnterConserve"
                root.out.event.category.name = "anti-virus engine state"
                root.out.event.message = "anti-virus engine entered conservation mode, low memory"
                root.out.event.severity.code = 3
                root.out.event.severity.level = "Error"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvEnterConserve"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvEnterConserve-unknown"
              root.out.event.category.name = "anti-virus engine state"
              root.out.event.message = "anti-virus engine entered conservation mode, low memory - UNEXPECTED VARBINDS for fgTrapAvEnterConserve trap!"
              root.out.event.severity.code = 3
              root.out.event.severity.level = "Error"

  - check: this.trap.SpecificTrap == 606
    # fgTrapAvBypass
    #
    # The anti-virus engine has been bypassed due to conservation mode
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 1 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
              meta varbinds_ok = true
          }}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgAntivirus"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvBypass"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvBypass"
                root.out.event.category.name = "anti-virus engine state"
                root.out.event.message = "anti-virus engine bypassed due to conservation mode"
                root.out.event.severity.code = 2
                root.out.event.severity.level = "Critical"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvBypass"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvBypass-unknown"
              root.out.event.category.name = "anti-virus engine state"
              root.out.event.message = "anti-virus engine bypassed due to conservation mode - UNEXPECTED VARBINDS for fgTrapAvBypass trap!"
              root.out.event.severity.code = 2
              root.out.event.severity.level = "Critical"

  - check: this.trap.SpecificTrap == 607
    # fgTrapAvOversizePass
    #
    # An over-sized file has been detected, but has been passed due to configuration
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 1 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
              meta varbinds_ok = true
          }}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgAntivirus"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversizePass"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversizePass"
                root.out.event.category.name = "anti-virus detection"
                root.out.event.message = "over-sized file detected, passed due to configuration"
                root.out.event.severity.code = 4
                root.out.event.severity.level = "Warning"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversizePass"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversizePass-unknown"
              root.out.event.category.name = "anti-virus detection"
              root.out.event.message = "over-sized file detected, passed due to configuration - UNEXPECTED VARBINDS for fgTrapAvOversizePass trap!"
              root.out.event.severity.code = 4
              root.out.event.severity.level = "Warning"

  - check: this.trap.SpecificTrap == 608
    # fgTrapAvOversizeBlock
    #
    # An over-sized file has been detected and has been blocked
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 1 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
              meta varbinds_ok = true
          }}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgAntivirus"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversizeBlock"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversizeBlock"
                root.out.event.category.name = "anti-virus detection"
                root.out.event.message = "over-sized file detected, blocked"
                root.out.event.severity.code = 2
                root.out.event.severity.level = "Critical"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversizeBlock"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapAvOversizeBlock-unknown"
              root.out.event.category.name = "anti-virus detection"
              root.out.event.message = "over-sized file detected, blocked - UNEXPECTED VARBINDS for fgTrapAvOversizeBlock trap!"
              root.out.event.severity.code = 2
              root.out.event.severity.level = "Critical"

  - check: this.trap.SpecificTrap == 701
    # fgTrapFazDisconnect
    #
    # The device has been disconnected from the FortiAnalyzer.
    #
    # fnSysSerial (DisplayString) - device serial number.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 0 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
              meta varbinds_ok = true
          }}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgMgmt"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFazDisconnect"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFazDisconnect"
                root.out.event.category.name = "FortiAnalyzer connection state"
                root.out.event.message = "FortiAnalyzer disconnected"
                root.out.event.severity.code = 3
                root.out.event.severity.level = "Error"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              }}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFazDisconnect"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFazDisconnect-unknown"
              root.out.event.category.name = "FortiAnalyzer connection state"
              root.out.event.message = "FortiAnalyzer disconnected - UNEXPECTED VARBINDS for fgTrapFazDisconnect trap!"
              root.out.event.severity.code = 3
              root.out.event.severity.level = "Error"

  - check: this.trap.SpecificTrap == 702
    # fgTrapFaz
    #
    # A trap for Fortianalyzer event.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgFazTrapType (INTEGER) - Fortianalyzer trap type
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 2 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.6.2.4") {
              meta varbinds_ok = true
          }}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                meta fgFazTrapType = this.trap.VarBinds.index(2).Value

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgFazTrapType = this.trap.VarBinds.index(2).Value.snmp_int_enum_enrich(".1.3.6.1.4.1.12356.101.6.2.4")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgMgmt"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFaz"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFaz"
                root.out.event.category.name = "FortiAnalyzer connection state"
                root.out.event.message = "FortiAnalyzer connection failover to " + root.out.fortinet.fgFazTrapType + " server"
                root.out.event.severity.code = 5
                root.out.event.severity.level = "Notice"

            - switch:
              - check: metadata("fgFazTrapType") == 1
                processors:
                  - mapping: |-
                      #!blobl
                      root = this
                      root.out.event.id = root.out.event.id + "-mainFailover"
              - check: metadata("fgFazTrapType") == 2
                processors:
                  - mapping: |-
                      #!blobl
                      root = this
                      root.out.event.id = root.out.event.id + "-altFailover"
              - processors:
                - mapping: |-
                    #!blobl
                    root = this
                    root.out.event.id = root.out.event.id + "-unknown"

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              }}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFaz"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFaz-unknown"
              root.out.event.category.name = "FortiAnalyzer connection state"
              root.out.event.message = "FortiAnalyzer connection failover - UNEXPECTED VARBINDS for fgTrapFaz trap!"
              root.out.event.severity.code = 4
              root.out.event.severity.level = "Warning"

  - check: this.trap.SpecificTrap == 801
    # fgTrapWcApUp
    #
    # Indicates that the specified AP is up.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgWcApVdom (Integer32) - Virtual domain the wtp is part of
    # fgWcApSerial (DisplayString) - Serial number of the wtp
    # fgWcApName (DisplayString) - Name of the wtp
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 4 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.14.1.1") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.14.1.2") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.14.1.3") {
              meta varbinds_ok = true
          }}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgWcApVdom = this.trap.VarBinds.index(2).Value.string()
                root.out.fortinet.fgWcApSerial = this.trap.VarBinds.index(3).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgWcApName = this.trap.VarBinds.index(4).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgWc"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "VDOM: " + root.out.fortinet.fgWcApVdom + ", WTP: " + root.out.fortinet.fgWcApName

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapWcApUp"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapWcApUp"
                root.out.event.category.name = "WAP state"
                root.out.event.message = "WAP up"
                root.out.event.severity.code = 6
                root.out.event.severity.level = "Informational"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapWcApUp"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapWcApUp-unknown"
              root.out.event.category.name = "WAP state"
              root.out.event.message = "WAP up - UNEXPECTED VARBINDS for fgTrapWcApUp trap!"
              root.out.event.severity.code = 5
              root.out.event.severity.level = "Notice"

  - check: this.trap.SpecificTrap == 802
    # fgTrapWcApDown
    #
    # Indicates that the specified AP is down.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgWcApVdom (Integer32) - Virtual domain the wtp is part of
    # fgWcApSerial (DisplayString) - Serial number of the wtp
    # fgWcApName (DisplayString) - Name of the wtp
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 4 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.14.1.1") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.14.1.2") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.14.1.3") {
              meta varbinds_ok = true
          }}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgWcApVdom = this.trap.VarBinds.index(2).Value.string()
                root.out.fortinet.fgWcApSerial = this.trap.VarBinds.index(3).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgWcApName = this.trap.VarBinds.index(4).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgWc"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "VDOM: " + root.out.fortinet.fgWcApVdom + ", WTP: " + root.out.fortinet.fgWcApName

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapWcApDown"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapWcApDown"
                root.out.event.category.name = "WAP state"
                root.out.event.message = "WAP down"
                root.out.event.severity.code = 3
                root.out.event.severity.level = "Error"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapWcApDown"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapWcApDown-unknown"
              root.out.event.category.name = "WAP state"
              root.out.event.message = "WAP down - UNEXPECTED VARBINDS for fgTrapWcApDown trap!"
              root.out.event.severity.code = 3
              root.out.event.severity.level = "Error"

  - check: this.trap.SpecificTrap == 901
    # fgTrapFcSwUp
    #
    # Indicates that the specified switch controller session is up.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgFcSwVdom (Integer32) - Virtual domain the switch is part of
    # fgFcSwSerial (DisplayString) - Serial number of the switch
    # fgFcSwName (DisplayString) - Name of the switch
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 4 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.15.1.1") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.15.1.2") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.15.1.3") {
              meta varbinds_ok = true
          }}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgFcSwVdom = this.trap.VarBinds.index(2).Value.string()
                root.out.fortinet.fgFcSwSerial = this.trap.VarBinds.index(3).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgFcSwName = this.trap.VarBinds.index(4).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgFc"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "VDOM: " + root.out.fortinet.fgFcSwVdom + ", switch: " + root.out.fortinet.fgFcSwName

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFcSwUp"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFcSwUp"
                root.out.event.category.name = "FC switch state"
                root.out.event.message = "FC switch up"
                root.out.event.severity.code = 6
                root.out.event.severity.level = "Informational"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFcSwUp"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFcSwUp-unknown"
              root.out.event.category.name = "FC switch state"
              root.out.event.message = "FC switch up - UNEXPECTED VARBINDS for fgTrapFcSwUp trap!"
              root.out.event.severity.code = 5
              root.out.event.severity.level = "Notice"

  - check: this.trap.SpecificTrap == 902
    # fgTrapFcSwDown
    #
    # Indicates that the specified switch controller session is down.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgFcSwVdom (Integer32) - Virtual domain the switch is part of
    # fgFcSwSerial (DisplayString) - Serial number of the switch
    # fgFcSwName (DisplayString) - Name of the switch
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 4 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.15.1.1") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.15.1.2") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.15.1.3") {
              meta varbinds_ok = true
          }}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgFcSwVdom = this.trap.VarBinds.index(2).Value.string()
                root.out.fortinet.fgFcSwSerial = this.trap.VarBinds.index(3).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgFcSwName = this.trap.VarBinds.index(4).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgFc"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "VDOM: " + root.out.fortinet.fgFcSwVdom + ", switch: " + root.out.fortinet.fgFcSwName

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFcSwDown"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFcSwDown"
                root.out.event.category.name = "FC switch state"
                root.out.event.message = "FC switch down"
                root.out.event.severity.code = 3
                root.out.event.severity.level = "Error"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFcSwDown"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapFcSwDown-unknown"
              root.out.event.category.name = "FC switch state"
              root.out.event.message = "FC switch down - UNEXPECTED VARBINDS for fgTrapFcSwDown trap!"
              root.out.event.severity.code = 3
              root.out.event.severity.level = "Error"

  - check: this.trap.SpecificTrap == 1101
    # fgTrapServerLoadBalanceRealServerDown
    #
    # One of servers in a Server Load Balance group goes down.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgServerLoadBalanceRealServerAddress (IpAddress) - IP of the real server.
    # fgServerLoadBalanceVirtualServerName (DisplayString) - Name of the virual server.
    # fgServerLoadBalanceRealServerAddress6 (Ipv6Address) - IPv6 of the real server.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 4 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.16.1.1") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.16.1.2") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.16.1.3") {
              meta varbinds_ok = true
          }}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgServerLoadBalanceRealServerAddress = this.trap.VarBinds.index(2).Value
                root.out.fortinet.fgServerLoadBalanceVirtualServerName = this.trap.VarBinds.index(3).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgServerLoadBalanceRealServerAddress6 = this.trap.VarBinds.index(4).Value.snmp_inet_address(2)

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgServerLoadBalance"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "virual server: " + root.out.fortinet.fgServerLoadBalanceVirtualServerName + ", real server IPv4: " + root.out.fortinet.fgServerLoadBalanceRealServerAddress + ", real server IPv6: " + root.out.fortinet.fgServerLoadBalanceRealServerAddress6

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapServerLoadBalanceRealServerDown"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapServerLoadBalanceRealServerDown"
                root.out.event.category.name = "SLB group state"
                root.out.event.message = "real server down"
                root.out.event.severity.code = 3
                root.out.event.severity.level = "Error"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapServerLoadBalanceRealServerDown"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapServerLoadBalanceRealServerDown-unknown"
              root.out.event.category.name = "SLB group state"
              root.out.event.message = "real server down - UNEXPECTED VARBINDS for fgTrapServerLoadBalanceRealServerDown trap!"
              root.out.event.severity.code = 3
              root.out.event.severity.level = "Error"

  - check: this.trap.SpecificTrap == 1102
    # fgTrapPerCpuHigh
    #
    # Indicates that per-CPU usage has exceeded the configured threshold.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgPerCpuHighDetails (DisplayString) - CPUs index string that the CPU usage has exceeded the configured threshold.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 2 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.4.4.4.1") {
              meta varbinds_ok = true
          }}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgPerCpuHighDetails = this.trap.VarBinds.index(2).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgProcessors"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "CPU: " + root.out.fortinet.fgPerCpuHighDetails

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapPerCpuHigh"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapPerCpuHigh"
                root.out.event.category.name = "per-CPU utilization threshold"
                root.out.event.message = "per-CPU utilization high"
                root.out.event.severity.code = 4
                root.out.event.severity.level = "Warning"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              }}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapPerCpuHigh"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapPerCpuHigh-unknown"
              root.out.event.category.name = "per-CPU utilization threshold"
              root.out.event.message = "per-CPU utilization high - UNEXPECTED VARBINDS for fgTrapPerCpuHigh trap!"
              root.out.event.severity.code = 4
              root.out.event.severity.level = "Warning"

  - check: this.trap.SpecificTrap == 1201
    # fgTrapDeviceNew
    #
    # A new device is found.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # ifIndex (Integer32) - A unique value, greater than zero, for each interface.
    # fgVdEntIndex (Integer32) - Internal virtual domain index used to uniquely identify rows in this table.
    # fgDeviceCreated (Gauge32) - The created time pertaining the Device.
    # fgDeviceLastSeen (Gauge32) - The last seen time pertaining the Device.
    # fgDeviceMacAddress (DisplayString) - The MAC address pertaining the Device.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 6 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.2.1.2.2.1.1") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.3.2.1.1.1") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.18.1.2") {
            if this.trap.VarBinds.index(5).OID.has_prefix(".1.3.6.1.4.1.12356.101.18.1.3") {
            if this.trap.VarBinds.index(6).OID.has_prefix(".1.3.6.1.4.1.12356.101.18.1.1") {
              meta varbinds_ok = true
          }}}}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.ietf.ifIndex = this.trap.VarBinds.index(2).Value.string()
                root.out.fortinet.fgVdEntIndex = this.trap.VarBinds.index(3).Value.string()
                root.out.fortinet.fgDeviceCreated = this.trap.VarBinds.index(4).Value
                root.out.fortinet.fgDeviceLastSeen = this.trap.VarBinds.index(5).Value
                root.out.fortinet.fgDeviceMacAddress = this.trap.VarBinds.index(6).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgDevice"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "MAC address: " + root.out.fortinet.fgDeviceMacAddress + ", interface: ifIndex " + root.out.ietf.ifIndex + ", VDOM: fgVdEntIndex " + root.out.fortinet.fgVdEntIndex

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapDeviceNew"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapDeviceNew"
                root.out.event.category.name = "device discovery"
                root.out.event.message = "new device found"
                root.out.event.severity.code = 5
                root.out.event.severity.level = "Notify"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapDeviceNew"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapDeviceNew-unknown"
              root.out.event.category.name = "device discovery"
              root.out.event.message = "new device found - UNEXPECTED VARBINDS for fgTrapDeviceNew trap!"
              root.out.event.severity.code = 4
              root.out.event.severity.level = "Warning"

  - check: this.trap.SpecificTrap == 1301
    # fgTrapDhcp
    #
    # A trap for DHCP or DHCP6 event.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # ifName (DisplayString) - The textual name of the interface.
    # fgVdEntName (DisplayString) - The name of the virtual domain
    # fgDhcpServerId (Integer32) - An ID that uniquely identifies a DHCP server within a vdom.
    # fgDhcpTrapType (INTEGER) - DHCP trap type
    # fgDhcpTrapMessage (DisplayString) - DHCP trap message including some optional server infos.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 6 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.2.1.31.1.1.1.1") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.3.2.1.1.2") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.23.3.3") {
            if this.trap.VarBinds.index(5).OID.has_prefix(".1.3.6.1.4.1.12356.101.23.3.1") {
            if this.trap.VarBinds.index(6).OID.has_prefix(".1.3.6.1.4.1.12356.101.23.3.2") {
              meta varbinds_ok = true
          }}}}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                meta fgDhcpTrapType = this.trap.VarBinds.index(5).Value

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.ietf.ifName = this.trap.VarBinds.index(2).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgVdEntName = this.trap.VarBinds.index(3).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgDhcpServerId = this.trap.VarBinds.index(4).Value.string()
                root.out.fortinet.fgDhcpTrapType = this.trap.VarBinds.index(5).Value.snmp_int_enum_enrich(".1.3.6.1.4.1.12356.101.23.3.1")
                root.out.fortinet.fgDhcpTrapMessage = this.trap.VarBinds.index(6).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgDhcp"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "interface: " + root.out.ietf.ifName + ", VDOM: " + root.out.fortinet.fgVdEntName + ", server ID: " + root.out.fortinet.fgDhcpServerId

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapDhcp"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapDhcp"

            - switch:
              - check: metadata("fgDhcpTrapType") == 1
                processors:
                  - mapping: |-
                      #!blobl
                      root = this

                      root.out.event.id = root.out.event.id + "-runOutOfIPPool"
                      root.out.event.category.name = "DHCP IP pool state"
                      root.out.event.message = "DHCP server IP pool fully allocated, " + root.out.fortinet.fgDhcpTrapMessage
                      root.out.event.severity.code = 3
                      root.out.event.severity.level = "Error"

              - check: metadata("fgDhcpTrapType") == 2
                processors:
                  - mapping: |-
                      #!blobl
                      root = this

                      root.out.event.id = root.out.event.id + "-conflictIP"
                      root.out.event.category.name = "DHCP lease state"
                      root.out.event.message = "DHCP IP conflict, " + root.out.fortinet.fgDhcpTrapMessage
                      root.out.event.severity.code = 3
                      root.out.event.severity.level = "Error"

              - check: metadata("fgDhcpTrapType") == 3
                processors:
                  - mapping: |-
                      #!blobl
                      root = this

                      root.out.event.id = root.out.event.id + "-receivedNAK"
                      root.out.event.category.name = "DHCP client state"
                      root.out.event.message = "DHCP client interface received NAK, " + root.out.fortinet.fgDhcpTrapMessage
                      root.out.event.severity.code = 3
                      root.out.event.severity.level = "Error"

              - processors:
                - mapping: |-
                    #!blobl
                    root = this

                    root.out.event.id = root.out.event.id + "-unknown"
                    root.out.event.category.name = "DHCP event"
                    root.out.event.message = "DHCP event, unknown type: " + root.out.fortinet.fgDhcpTrapType + ", " + root.out.fortinet.fgDhcpTrapMessage
                    root.out.event.severity.code = 4
                    root.out.event.severity.level = "Warning"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapDhcp"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapDhcp-unknown"
              root.out.event.category.name = "DHCP event"
              root.out.event.message = "DHCP event - UNEXPECTED VARBINDS for fgTrapDhcp trap!"
              root.out.event.severity.code = 4
              root.out.event.severity.level = "Warning"

  - check: this.trap.SpecificTrap == 1401
    # fgTrapPoolUsage
    #
    # A trap for ippool.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgFwIppTrapType (INTEGER) - Pool usage trap type
    # fgFwIppStatsName (DisplayString) - Name of the ippool.
    # fgFwIppStatsGroupName (DisplayString) - The pool group name if it is in an IP pool group.
    # fgFwTrapPoolUtilization (Gauge32) - Pool Usage percent.
    # fgFwIppTrapPoolProto (Integer32) - Pool usage protocol udp/tcp.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 6 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.5.3.3.1") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.5.3.2.1.1.1") {
            if this.trap.VarBinds.index(4).OID.has_prefix(".1.3.6.1.4.1.12356.101.5.3.2.1.1.14") {
            if this.trap.VarBinds.index(5).OID.has_prefix(".1.3.6.1.4.1.12356.101.5.3.3.2") {
            if this.trap.VarBinds.index(6).OID.has_prefix(".1.3.6.1.4.1.12356.101.5.3.3.3") {
              meta varbinds_ok = true
          }}}}}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                meta fgFwIppTrapType = this.trap.VarBinds.index(2).Value

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgFwIppTrapType = this.trap.VarBinds.index(2).Value.snmp_int_enum_enrich(".1.3.6.1.4.1.12356.101.5.3.3.1")
                root.out.fortinet.fgFwIppStatsName = this.trap.VarBinds.index(3).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgFwIppStatsGroupName = this.trap.VarBinds.index(4).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgFwTrapPoolUtilization = this.trap.VarBinds.index(5).Value
                root.out.fortinet.fgFwIppTrapPoolProto = this.trap.VarBinds.index(6).Value.string()

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgFwIppStatsEntry"
                root.out.object.index = this.trap.VarBinds.index(3).OID.snmp_oid_get_index(".1.3.6.1.4.1.12356.101.5.3.2.1.1.1")
                root.TEMP.fgFwIppStatsEntry = root.out.object.index.snmp_oid_extract_index("IpAddress,IpAddress")
                root.out.fortinet.fgFwIppStatsStartIp = root.TEMP.fgFwIppStatsEntry.index(0)
                root.out.fortinet.fgFwIppStatsEndIp = root.TEMP.fgFwIppStatsEntry.index(1)
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "IP pool: " + root.out.fortinet.fgFwIppStatsName + ", IP pool group: " + root.out.fortinet.fgFwIppStatsGroupName + ", start IP: " + root.out.fortinet.fgFwIppStatsStartIp + ", end IP: " + root.out.fortinet.fgFwIppStatsEndIp

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapPoolUsage"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapPoolUsage"
                root.out.event.category.name = "IP pool threshold"

            - switch:
              - check: metadata("fgFwIppTrapType") == 1
                processors:
                  - mapping: |-
                      #!blobl
                      root = this

                      root.out.event.id = root.out.event.id + "-raise"
                      root.out.event.message = "IP pool utilization high: " + root.out.fortinet.fgFwTrapPoolUtilization.string() + "%"
                      root.out.event.severity.code = 4
                      root.out.event.severity.level = "Warning"

              - check: metadata("fgFwIppTrapType") == 2
                processors:
                  - mapping: |-
                      #!blobl
                      root = this

                      root.out.event.id = root.out.event.id + "-clear"
                      root.out.event.message = "IP pool utilization recovered: " + root.out.fortinet.fgFwTrapPoolUtilization.string() + "%"
                      root.out.event.severity.code = 1
                      root.out.event.severity.level = "Informational"

              - processors:
                - mapping: |-
                    #!blobl
                    root = this

                    root.out.event.id = root.out.event.id + "-unknown"
                    root.out.event.message = "IP pool utilization unknown"
                    root.out.event.severity.code = 4
                    root.out.event.severity.level = "Warning"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              if this.trap.VarBinds.length() > 7 {
                root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
                root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
                }
              }}}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapPoolUsage"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapPoolUsage-unknown"
              root.out.event.category.name = "IP pool threshold"
              root.out.event.message = "IP pool utilization unknown - UNEXPECTED VARBINDS for fgTrapPoolUsage trap!"
              root.out.event.severity.code = 4
              root.out.event.severity.level = "Warning"

  - check: this.trap.SpecificTrap == 1501
    # fgTrapSlbc
    #
    # A trap for SLBC event.
    #
    # fnSysSerial (DisplayString) - device serial number.
    # sysName (DisplayString) - An administratively-assigned name for this managed node.
    # fgChassisSlotId (Integer32) - Chassis slot Id at current chassis.
    # fgChassisTrapMessage (DisplayString) - SLBC trap message display.
    processors:
      - mapping: |-
          #!blobl
          root = this

          meta varbinds_ok = false
          if this.trap.VarBinds.length() > 3 {
            if this.trap.VarBinds.index(0).OID.has_prefix(".1.3.6.1.4.1.12356.100.1.1.1") {
            if this.trap.VarBinds.index(1).OID.has_prefix(".1.3.6.1.2.1.1.5") {
            if this.trap.VarBinds.index(2).OID.has_prefix(".1.3.6.1.4.1.12356.101.25.2.1") {
            if this.trap.VarBinds.index(3).OID.has_prefix(".1.3.6.1.4.1.12356.101.25.2.2") {
              meta varbinds_ok = true
          }}}}}

      - switch:
        - check: metadata("varbinds_ok")
          processors:
            - mapping: |-
                #!blobl
                root = this

                root.out.fortinet.fnSysSerial = this.trap.VarBinds.index(0).Value.snmp_octet_display_hint("255t")
                root.out.ietf.sysName = this.trap.VarBinds.index(1).Value.snmp_octet_display_hint("255t")
                root.out.fortinet.fgChassisSlotId = this.trap.VarBinds.index(2).Value.string()
                root.out.fortinet.fgChassisTrapMessage = this.trap.VarBinds.index(3).Value.snmp_octet_display_hint("255t")

                root.out.object.name = "FORTINET-FORTIGATE-MIB::fgChassis"
                root.out.object.index = "0"
                root.out.object.entity = this.trap.AgentAddress.string() + "_" + root.out.object.name + "." + root.out.object.index
                root.out.object.label = "slot: " + root.out.fortinet.fgChassisSlotId

                root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapSlbc"
                root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapSlbc"
                root.out.event.category.name = "SLBC event"
                root.out.event.message = "SLBC event: " + root.out.fortinet.fgChassisTrapMessage
                root.out.event.severity.code = 4
                root.out.event.severity.level = "Warning"

            - mapping: |-
                #!blobl
                root = this

                root.out.event.message = if root.out.exists("object.label") {
                  root.out.event.message + "  [ " + root.out.object.label + " ]"
                }

        - processors:
          - mapping: |-
              #!blobl
              root = this

              if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
                root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
                root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
                }
              if this.trap.VarBinds.length() > 1 {
                root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
                root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
                }
              if this.trap.VarBinds.length() > 2 {
                root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
                root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
                }
              if this.trap.VarBinds.length() > 3 {
                root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
                root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
                }
              if this.trap.VarBinds.length() > 4 {
                root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
                root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
                }
              if this.trap.VarBinds.length() > 5 {
                root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
                root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
                }
              if this.trap.VarBinds.length() > 6 {
                root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
                root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
                if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
                } else {
                  root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
                }
              }}}}}}}

              root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapSlbc"
              root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-fgTrapSlbc-unknown"
              root.out.event.category.name = "SLBC event"
              root.out.event.message = "SLBC event - UNEXPECTED VARBINDS for fgTrapSlbc trap!"
              root.out.event.severity.code = 4
              root.out.event.severity.level = "Warning"

  - processors:
    - label: default
      mapping: |
        #!blobl
        root = this

        if this.trap.exists("VarBinds") && this.trap.VarBinds.length() > 0 {
          root.out.snmptrap.varbind.oid_0 = this.trap.VarBinds.index(0).OID
          root.out.snmptrap.varbind.type_0 = this.trap.VarBinds.index(0).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(0).Type == 4 || this.trap.VarBinds.index(0).Type == 68 {
            root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_0 = this.trap.VarBinds.index(0).Value.string()
          }
        if this.trap.VarBinds.length() > 1 {
          root.out.snmptrap.varbind.oid_1 = this.trap.VarBinds.index(1).OID
          root.out.snmptrap.varbind.type_1 = this.trap.VarBinds.index(1).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(1).Type == 4 || this.trap.VarBinds.index(1).Type == 68 {
            root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_1 = this.trap.VarBinds.index(1).Value.string()
          }
        if this.trap.VarBinds.length() > 2 {
          root.out.snmptrap.varbind.oid_2 = this.trap.VarBinds.index(2).OID
          root.out.snmptrap.varbind.type_2 = this.trap.VarBinds.index(2).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(2).Type == 4 || this.trap.VarBinds.index(2).Type == 68 {
            root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_2 = this.trap.VarBinds.index(2).Value.string()
          }
        if this.trap.VarBinds.length() > 3 {
          root.out.snmptrap.varbind.oid_3 = this.trap.VarBinds.index(3).OID
          root.out.snmptrap.varbind.type_3 = this.trap.VarBinds.index(3).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(3).Type == 4 || this.trap.VarBinds.index(3).Type == 68 {
            root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_3 = this.trap.VarBinds.index(3).Value.string()
          }
        if this.trap.VarBinds.length() > 4 {
          root.out.snmptrap.varbind.oid_4 = this.trap.VarBinds.index(4).OID
          root.out.snmptrap.varbind.type_4 = this.trap.VarBinds.index(4).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(4).Type == 4 || this.trap.VarBinds.index(4).Type == 68 {
            root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_4 = this.trap.VarBinds.index(4).Value.string()
          }
        if this.trap.VarBinds.length() > 5 {
          root.out.snmptrap.varbind.oid_5 = this.trap.VarBinds.index(5).OID
          root.out.snmptrap.varbind.type_5 = this.trap.VarBinds.index(5).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(5).Type == 4 || this.trap.VarBinds.index(5).Type == 68 {
            root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_5 = this.trap.VarBinds.index(5).Value.string()
          }
        if this.trap.VarBinds.length() > 6 {
          root.out.snmptrap.varbind.oid_6 = this.trap.VarBinds.index(6).OID
          root.out.snmptrap.varbind.type_6 = this.trap.VarBinds.index(6).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(6).Type == 4 || this.trap.VarBinds.index(6).Type == 68 {
            root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_6 = this.trap.VarBinds.index(6).Value.string()
          }
        if this.trap.VarBinds.length() > 7 {
          root.out.snmptrap.varbind.oid_7 = this.trap.VarBinds.index(7).OID
          root.out.snmptrap.varbind.type_7 = this.trap.VarBinds.index(7).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(7).Type == 4 || this.trap.VarBinds.index(7).Type == 68 {
            root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_7 = this.trap.VarBinds.index(7).Value.string()
          }
        if this.trap.VarBinds.length() > 8 {
          root.out.snmptrap.varbind.oid_8 = this.trap.VarBinds.index(8).OID
          root.out.snmptrap.varbind.type_8 = this.trap.VarBinds.index(8).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(8).Type == 4 || this.trap.VarBinds.index(8).Type == 68 {
            root.out.snmptrap.varbind.value_8 = this.trap.VarBinds.index(8).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_8 = this.trap.VarBinds.index(8).Value.string()
          }
        if this.trap.VarBinds.length() > 9 {
          root.out.snmptrap.varbind.oid_9 = this.trap.VarBinds.index(9).OID
          root.out.snmptrap.varbind.type_9 = this.trap.VarBinds.index(9).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(9).Type == 4 || this.trap.VarBinds.index(9).Type == 68 {
            root.out.snmptrap.varbind.value_9 = this.trap.VarBinds.index(9).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_9 = this.trap.VarBinds.index(9).Value.string()
          }
        if this.trap.VarBinds.length() > 10 {
          root.out.snmptrap.varbind.oid_10 = this.trap.VarBinds.index(10).OID
          root.out.snmptrap.varbind.type_10 = this.trap.VarBinds.index(10).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(10).Type == 4 || this.trap.VarBinds.index(10).Type == 68 {
            root.out.snmptrap.varbind.value_10 = this.trap.VarBinds.index(10).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_10 = this.trap.VarBinds.index(10).Value.string()
          }
        if this.trap.VarBinds.length() > 11 {
          root.out.snmptrap.varbind.oid_11 = this.trap.VarBinds.index(11).OID
          root.out.snmptrap.varbind.type_11 = this.trap.VarBinds.index(11).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(11).Type == 4 || this.trap.VarBinds.index(11).Type == 68 {
            root.out.snmptrap.varbind.value_11 = this.trap.VarBinds.index(11).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_11 = this.trap.VarBinds.index(11).Value.string()
          }
        if this.trap.VarBinds.length() > 12 {
          root.out.snmptrap.varbind.oid_12 = this.trap.VarBinds.index(12).OID
          root.out.snmptrap.varbind.type_12 = this.trap.VarBinds.index(12).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(12).Type == 4 || this.trap.VarBinds.index(12).Type == 68 {
            root.out.snmptrap.varbind.value_12 = this.trap.VarBinds.index(12).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_12 = this.trap.VarBinds.index(12).Value.string()
          }
        if this.trap.VarBinds.length() > 13 {
          root.out.snmptrap.varbind.oid_13 = this.trap.VarBinds.index(13).OID
          root.out.snmptrap.varbind.type_13 = this.trap.VarBinds.index(13).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(13).Type == 4 || this.trap.VarBinds.index(13).Type == 68 {
            root.out.snmptrap.varbind.value_13 = this.trap.VarBinds.index(13).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_13 = this.trap.VarBinds.index(13).Value.string()
          }
        if this.trap.VarBinds.length() > 14 {
          root.out.snmptrap.varbind.oid_14 = this.trap.VarBinds.index(14).OID
          root.out.snmptrap.varbind.type_14 = this.trap.VarBinds.index(14).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(14).Type == 4 || this.trap.VarBinds.index(14).Type == 68 {
            root.out.snmptrap.varbind.value_14 = this.trap.VarBinds.index(14).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_14 = this.trap.VarBinds.index(14).Value.string()
          }
        if this.trap.VarBinds.length() > 15 {
          root.out.snmptrap.varbind.oid_15 = this.trap.VarBinds.index(15).OID
          root.out.snmptrap.varbind.type_15 = this.trap.VarBinds.index(15).Type.snmp_int_enum_enrich(".1_SnmpTypes")
          if this.trap.VarBinds.index(15).Type == 4 || this.trap.VarBinds.index(15).Type == 68 {
            root.out.snmptrap.varbind.value_15 = this.trap.VarBinds.index(15).Value.snmp_octet_string()
          } else {
            root.out.snmptrap.varbind.value_15 = this.trap.VarBinds.index(15).Value
          }
        }}}}}}}}}}}}}}}}

        root.out.event.class.name = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-unknown"
        root.out.event.id = "SNMPTRAP-FORTINET-FORTIGATE-MIB-fgTraps-" + this.trap.SpecificTrap.string()
        root.out.event.category.name = "unknown specific trap"
        root.out.event.message = "unknown specific trap " + this.trap.SpecificTrap.string() + " from Fortinet FORTINET-FORTIGATE-MIB-fgTraps"
        root.out.event.severity.code = 4
        root.out.event.severity.level = "Warning"
